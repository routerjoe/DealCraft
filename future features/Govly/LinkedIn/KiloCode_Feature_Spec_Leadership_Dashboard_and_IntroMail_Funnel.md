# Kilo Code Feature Spec — Leadership Dashboard & IntroMail Funnel (MCP Analytics Tab)
Date: Saturday, October 18 2025 EDT  
Owner: Joe Nolan (Red River)  
Context: Red River Sales MCP — Federal (Customer Alpha, Customer Beta, MDA, ARCENT, AFTAC, AFSOC, USCYBERCOM); Vehicles (SEWP, CHESS, 2GIT, ITES‑3H/4H); OEMs (Cisco, Nutanix, NetApp, Dell, VMware)

---

## 1) Summary
Package the **Leadership Dashboard** and **IntroMail Funnel** as a future enhancement for the Red River Sales MCP, implemented with **Kilo Code** for the TUI and command runners. The feature reads weekly lead outputs and renders executive KPIs, OEM/Vehicle/Agency breakdowns, funnel progression, and trends—without storing secrets in code.

---

## 2) Goals & Non‑Goals
**Goals**
1. Surface executive KPIs for weekly leads and outreach.
2. Provide OEM leaderboard, contract‑vehicle mix, and agency engagement at a glance.
3. Track IntroMail funnel stages (Queued → Sent → Replied → Meeting).
4. Show 8‑week trendline (leads, readiness, avg net margin %, top vehicle).
5. Keep file‑based artifacts to fit Obsidian + MCP workflows; TUI built with Kilo Code.

**Non‑Goals**
- No live CRM writeback.
- No LinkedIn API integration (input is CSV ingest).
- No email‑sending logic here (reuses existing MCP/Graph/SMTP workflow).

---

## 3) User Stories
1. **As an AE**, I want a single command to render a dashboard so I can share a concise weekly view with leadership.
2. **As a BD lead**, I want to see which OEMs and vehicles dominate the week to tune campaigns (Cisco, Nutanix, NetApp; SEWP/ITES, etc.).
3. **As an AE**, I want funnel counts and trendlines to understand throughput and bottlenecks (e.g., many “Queued” but few “Sent”).

---

## 4) Artifacts & Inputs
**Primary inputs**
- `out/leads_week_YYYY-MM-DD.csv` (generated by ingest job)
- `out/intromail_events.csv` (append‑only log for outreach status)

**Outputs**
- `out/leadership_dashboard.md` (rendered dashboard for Analytics tab)
- Optional: on‑screen TUI rendering for quick review

**Config**
- `fees.json` for vehicle fee rates (decimals; e.g., 0.0034 = 0.34%)

---

## 5) Data Schemas
**leads_week_*.csv** (subset; columns may include more)
- Name, Title, Company, Location, LinkedIn URL, Industry, Notes
- Customer_Price (USD), Cost (USD)
- _score (int), _agency (string), _vehicle (CSV of terms), _bucket (Ready/Nurture/Archive)
- _vehicle_fee_rate (decimal), _vehicle_fee_amount (USD)
- _gross_margin (USD), _net_margin (USD), _margin_percent (%)

**intromail_events.csv**
```csv
timestamp,linkedin_url,status,notes
2025-10-18T08:30:00,https://www.linkedin.com/in/contact,Queued,queued by MCP
2025-10-18T09:15:00,https://www.linkedin.com/in/contact,Sent,email sent via Outlook
2025-10-19T12:10:00,https://www.linkedin.com/in/contact,Replied,requested meeting
2025-10-20T14:00:00,https://www.linkedin.com/in/contact,Meeting,scheduled 30-min call
```

**fees.json**
```json
{ "SEWP": 0.0034, "CHESS": 0.0, "2GIT": 0.0, "ITES": 0.0, "ITES-3H": 0.0, "ITES-4H": 0.0 }
```

---

## 6) KPIs & Calculations
- Vehicle Fee Amount = `Customer_Price × Vehicle_Fee_Rate`
- Gross Margin ($)   = `Customer_Price − Cost`
- Net Margin ($)     = `Customer_Price − Cost − Vehicle Fee Amount`
- Margin %           = `Net Margin ÷ Customer_Price × 100`

**Dashboard sections**
1. KPI Snapshot: totals; Ready/Nurture/Archive; total vehicle fees; total potential net margin; avg net margin %.
2. OEM Leaderboard (mentions): Cisco, Nutanix, NetApp, Dell, VMware, etc.
3. OEM Win Signals (keywords): UCS, Catalyst, SD‑WAN, ISE, UCS M7 (Cisco); HCI, AHV, AOS (Nutanix); ONTAP, AFF, FSxN (NetApp); etc.
4. Contract Vehicle Mix: SEWP, CHESS, 2GIT, ITES‑3H/4H.
5. Agency Engagement: Customer Alpha, Customer Beta, MDA, ARCENT, AFTAC, AFSOC, USCYBERCOM, Eglin/Tyndall/Patrick.
6. IntroMail Funnel: counts for Queued, Sent, Replied, Meeting (from `intromail_events.csv`).
7. Trends (8 weeks): Week | Leads | Ready | Avg Net % | Top Vehicle.
8. Top Contacts (by score).

---

## 7) TUI Requirements (Kilo Code)
- Command: `mcp:render_leadership_dashboard`
  - Action: runs dashboard generator; displays markdown.
- Optional: `mcp:intromail_event` (args: linkedin_url, status, notes)
  - Appends to `out/intromail_events.csv` for funnel tracking.
- UX:
  - Arrow keys / j‑k to navigate sections.
  - Press `E` to open the generated `leadership_dashboard.md` in default editor.
  - Press `O` to open `out/` folder.

---

## 8) File Layout (proposed)
```
red-river-sales-mcp/
└─ analytics/
   ├─ analytics_dashboard.py           # generator (already provided in v3 bundle)
   ├─ dashboard_spec.md                # this spec
   ├─ templates/                       # any TUI views (future)
   └─ README.md                        # run instructions for Kilo Code
```

---

## 9) Acceptance Criteria
- [ ] Executing `mcp:render_leadership_dashboard` produces/updates `out/leadership_dashboard.md` and shows it in the Analytics tab.
- [ ] Dashboard includes KPI Snapshot, OEM leaderboard, Vehicle mix, Agency engagement, Funnel, Trends (8 weeks), Top Contacts.
- [ ] Dashboard reads `fees.json` for fee rates; fee/margin math matches formulas above.
- [ ] If `Customer_Price`/`Cost` absent, dashboard computes non‑price metrics and clearly indicates that margin metrics are unavailable.
- [ ] Funnel section reflects counts from `intromail_events.csv` with statuses: Queued, Sent, Replied, Meeting.
- [ ] No secrets hard‑coded; `.env` continues to be used only for email features (outside this scope).

---

## 10) Edge Cases
- Empty `out/` directory → graceful message (“no weekly CSV found”).
- Multiple vehicles detected in a row → list all in `_vehicle`; fee math uses the first (no precedence map).
- Bad CSV headers → skip row and log warning; still render dashboard.

---

## 11) Future Enhancements
- Tie funnel metrics directly to **Outlook Drafts/Sent** logs.
- Add export: `leadership_dashboard.html` for sharing.
- Add simple chart sprites (ASCII or image) for trends.

---

## 12) Implementation Notes
- Keep dependencies stdlib‑only for the dashboard generator (CSV, glob, datetime).
- Continue using file‑based artifacts to fit Obsidian + Git workflows.
- Maintain **federal & vendor context**: Cisco, Nutanix, NetApp, Dell, VMware; SEWP/2GIT/CHESS/ITES; agencies listed above.

---

## 13) Runbook Snippet
```bash
# Generate weekly outputs first
python3 mcp_linkedin_ingest.py

# Then render dashboard for Analytics tab
python3 analytics_dashboard.py
```

---

## 14) Contacts
- AE/Owner: Joe Nolan — Red River (Customer Alpha / Customer Beta / MDA focus)
- Engineering: Kilo Code (TUI + command integration)

